# DailyWife 每日老婆插件

一个基于 AstrBot 框架的 QQ 群聊伴侣配对插件，支持随机配对、许愿、强娶等趣味功能。

## 功能特色

### 🎯 基础功能
- **随机配对** - 使用 `今日老婆` 命令随机匹配群内成员
- **伴侣查询** - 使用 `查询老婆` 查看当前伴侣信息
- **解除关系** - 使用 `我要分手` 解除当前伴侣关系
- **冷静期机制** - 分手后48小时内无法再次匹配同一用户
- **头像显示** - 支持显示伴侣头像（可配置开关）

### ⚡ 进阶功能（需管理员开启）
- **许愿功能** - 使用 `/许愿 [QQ号]` 指定心仪伴侣（每日1次）
- **强娶功能** - 使用 `/强娶 [QQ号]` 抢夺他人伴侣（每日2次）
- **锁定功能** - 使用 `/锁定` 防止被强娶（被抽方每日1次）

### 🔒 隐私保护
- **手动黑名单** - 支持添加/删除黑名单，防止与特定用户匹配
- **双向屏蔽** - 支持单向/双向屏蔽，灵活控制匹配范围
- **全局排除** - 自动排除系统账号（如QQ群管家）

### ⚙️ 管理功能
- **数据重置** - 支持多种数据重置选项
- **进阶功能控制** - 管理员可开启/关闭群内进阶功能
- **使用限制** - 可配置每日使用次数和冷却时间

## 安装说明

### 环境要求
- Python 3.8+
- AstrBot 框架
- Napcat 连接器（支持多主机负载均衡）

### 安装步骤
1. 将插件文件放入 AstrBot 的插件目录
2. 配置 Napcat 连接信息（见配置说明）
3. 重启 AstrBot 服务

## 配置说明

本插件依赖Napcat api服务
- 在napcat面板设置服务端口

![alt text](img/image.png)
![alt text](img/image-1.png)
![alt text](img/image-2.png)
![alt text](img/image-3.png)

- 测试api可用性

![alt text](img/image-4.png)
![alt text](img/image-5.png)
⚠注意此处测试的是用“设置账号信息”来测试api，如果请求体不改，bot的昵称，签名都会变成"textValue"
你也可以用这个界面的其他功能来测试api
![alt text](img/image-6.png)
另外说明：在napcat里面测试不成功也不要紧，
重要的是确保astrbot可以访问你的api地址，
如果astrbot也无法访问你的api，请检查防火墙、端口、网络以及容器的问题。

- 如果可用，请进行最后一步配置

![alt text](img/image-7.png)

## 使用命令

### 用户命令
- `今日老婆` - 随机配对伴侣
- `查询老婆` - 查看当前伴侣
- `我要分手` - 解除伴侣关系
- `老婆菜单` - 查看完整功能说明

### 进阶命令（需开启）
- `/许愿 [QQ号]` - 指定伴侣
- `/强娶 [QQ号]` - 抢夺他人伴侣
- `/锁定` - 锁定当前关系

### 黑名单管理
- `/添加黑名单 [QQ号] [all/群号] [双向/单向]`
- `/删除黑名单 [QQ号] [all/群号]`
- `/查看黑名单 [QQ号]`

### 管理员命令
- `/重置` - 各类数据重置（支持多种选项）
- `/开启老婆插件进阶功能` - 开启群内进阶功能
- `/关闭进阶老婆插件功能` - 关闭群内进阶功能

## 数据文件说明

插件会在插件目录下生成以下数据文件：

- `pair_data.json` - 配对记录数据
- `cooling_data.json` - 冷静期数据
- `user_manual_blocked_peer.json` - 手动黑名单
- `breakup_counts.json` - 分手次数统计
- `advanced_enabled.json` - 进阶功能开启状态

## 注意事项

1. **风险提示**：进阶功能可能引发群内争议，建议管理员谨慎开启
2. **数据安全**：定期备份数据文件，防止数据丢失
3. **性能考虑**：群成员过多时可能影响匹配速度
4. **隐私保护**：插件会存储用户QQ号和昵称信息

## 故障排除

### 常见问题
1. **无法获取群成员**：检查 Napcat 连接配置
2. **配对失败**：确认目标用户不在黑名单中
3. **头像不显示**：检查网络连接和头像服务器状态

### 日志查看
插件运行日志会输出到控制台，包含详细的错误信息和调试信息。

## 更新日志

### v1.0.3
- 优化黑名单机制
- 增强错误处理

## 技术支持

如有问题或建议，请提交 Issue 或联系开发者。

---

**注意**：本插件仅供娱乐使用，请勿用于商业用途或违反相关法律法规的场景。
