# 每日老婆插件 (DailyWife)

一个基于 Astral Bot 框架的QQ群聊娱乐插件，每日为群成员随机配对"老婆"，支持多种互动功能。
# （如果是安装完插件弹出的README，可能会出现无法显示图片的情况，请手动前往GitHub仓库地址查看）
### 前置需求（一定要看！）
本插件适合搭配napcat使用
本插件依赖Napcat api服务
- 在napcat面板设置服务端口

![alt text](img/image.png)
![alt text](img/image-1.png)
![alt text](img/image-2.png)
![alt text](img/image-3.png)

- 测试api可用性

![alt text](img/image-4.png)
![alt text](img/image-5.png)
⚠注意此处测试的是用“设置账号信息”来测试api，如果请求体不改，bot的昵称，签名都会变成"textValue"
你也可以用这个界面的其他功能来测试api
![alt text](img/image-6.png)
另外说明：在napcat里面测试不成功也不要紧，
重要的是确保astrbot可以访问你的api地址，
如果astrbot也无法访问你的api，请检查防火墙、端口、网络以及容器的问题。

- 如果可用，请进行最后一步配置

![alt text](img/image-7.png)


## 功能特色

### 🎯 基础功能
- **今日老婆** - 每日随机配对群内成员
- **查询老婆** - 查看当前配对状态
- **我要分手** - 解除当前配对关系
- **个人屏蔽** - 自定义屏蔽不想匹配的用户

### ⚡ 进阶功能（需管理员开启）
- **许愿** - 指定心仪对象作为伴侣（每日限1次）
- **强娶** - 抢夺他人的伴侣（每日限2次）
- **锁定** - 防止被他人强娶（每日限1次，仅被抽方可使用）

### 🛡️ 管理功能
- 完整的群组数据管理
- 用户屏蔽管理
- 冷静期时间设置
- 进阶功能开关控制

## 安装说明

### 前置要求
- Astral Bot 框架
- Napcat QQ 机器人服务（支持多主机配置）

### 安装步骤
1. 将插件文件放入 Astral Bot 的插件目录
2. 配置 `config.yaml` 文件（详见配置说明）
3. 重启机器人加载插件

## 配置说明

在 Astral Bot 的配置文件中添加以下配置：

```yaml
DailyWife:
  # Napcat 服务配置（支持多个主机，用逗号分隔）
  napcat_host: "127.0.0.1:3000,127.0.0.1:3001"
  request_timeout: 10
  
  # 功能限制配置
  max_daily_breakups: 3           # 每日最大分手次数
  breakup_block_hours: 24         # 超限后屏蔽时长（小时）
  default_cooling_hours: 48       # 分手后冷静期（小时）
  
  # 进阶功能限制
  max_daily_wishes: 1             # 每日许愿次数
  max_daily_rob_attempts: 2       # 每日强娶次数
  max_daily_lock: 1               # 每日锁定次数
  
  # 显示配置
  show_avatar: true               # 是否显示头像
  avatar_size: 100                # 头像尺寸
  display_name_max_length: 10     # 显示名称最大长度
  
  # 全局开关
  enable_advanced_globally: false # 是否全局开启进阶功能
```

## 使用命令

### 基础命令
- `今日老婆` - 随机配对
- `查询老婆` - 查看当前伴侣
- `我要分手` - 解除关系
- `老婆菜单` - 查看完整功能说明

### 个人屏蔽命令
- `/屏蔽用户 [QQ号/@用户]` - 屏蔽指定用户
- `/取消屏蔽 [QQ号/@用户]` - 取消屏蔽
- `/我的屏蔽列表` - 查看已屏蔽用户

### 管理员命令
- `/重置 -a` - 重置所有数据
- `/重置 -p` - 重置配对数据
- `/重置 -c` - 重置冷静期数据
- `/重置 -b` - 重置屏蔽名单
- `/重置 -d` - 重置分手记录
- `/重置 -e` - 重置进阶功能状态
- `/重置 -u` - 重置用户手动屏蔽列表
- `/屏蔽 [QQ号]` - 全局屏蔽用户
- `/冷静期 [小时]` - 设置冷静期时长
- `/开启老婆插件进阶功能` - 开启进阶功能
- `/关闭进阶老婆插件功能` - 关闭进阶功能

### 进阶命令（需开启）
- `/许愿 [QQ号]` - 指定伴侣
- `/强娶 [QQ号]` - 抢夺他人伴侣
- `/锁定` - 锁定当前关系

## 数据文件说明

插件会自动生成以下数据文件：

- `pair_data.json` - 配对数据
- `cooling_data.json` - 冷静期数据
- `blocked_users.json` - 全局屏蔽列表
- `breakup_counts.json` - 分手次数记录
- `advanced_enabled.json` - 进阶功能开启状态
- `user_manual_blocked_peer.json` - 用户个人屏蔽列表

## 特色功能详解

### 🎲 随机配对算法
- 自动排除自己、机器人、已配对用户
- 支持冷静期机制，避免重复配对
- 支持个人屏蔽列表，尊重用户选择
- 全局屏蔽QQ群管家（2854196310）

### 💝 进阶功能保护
- 许愿功能：只能对未配对用户使用
- 强娶功能：可抢夺他人伴侣，但受锁定保护
- 锁定功能：防止被强娶，只有被抽方可以使用

### ⏰ 智能重置系统
- 每日自动重置配对数据
- 自动清理过期冷静期记录
- 分手次数每日重置
- 进阶功能使用次数每日重置

## 注意事项

1. **权限要求**：部分管理命令需要管理员权限
2. **数据安全**：定期备份数据文件以防丢失
3. **性能优化**：支持多Napcat主机负载均衡
4. **兼容性**：基于 Astral Bot 框架，确保框架版本兼容

## 故障排除

### 常见问题
1. **无法获取群成员**：检查 Napcat 服务是否正常运行
2. **配对失败**：确认群内有足够的活跃成员
3. **命令无响应**：检查机器人权限和命令格式

### 日志查看
插件会输出详细的操作日志，可在机器人日志中查看运行状态和错误信息。

## 更新日志

### v1.0.3
- 新增用户个人屏蔽功能
- 全局屏蔽QQ群管家

## 技术支持

如有问题或建议，请提交 Issue 或联系开发者。

---
**免责声明**：本插件仅供娱乐使用，请勿用于商业用途或违反相关法律法规的场景。
